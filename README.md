# Database Clean Washing

**Database Clean Washing** is a PowerShell script for Conan Exiles servers, designed to ensure that the assets in the game’s SQLite database align with assets found in the `.pak` files for server mods. It verifies, backs up, and compares database-stored Mod Assets against those in `.pak` files, generating a list of mismatched assets when found.

## Prerequisites

- **UnrealPak.exe**: This script requires `UnrealPak.exe` (available in the Conan Exiles DevKit) to read `.pak` files. Place this executable in the same directory as the script.
- **Database Name**: Set the `$databaseName` variable within the script to match the name of your SQLite database, excluding the `.db` extension.
- **Script Location**: Place this script in the `DatabaseCleanWashing` directory under the `Saved` folder of your Conan Exiles server at the following path: `...\ConanSandbox\Saved\DatabaseCleanWashing\database_clean_washing.ps1`

## Using the Script

### Steps

1. **Place `UnrealPak.exe`**: Make sure `UnrealPak.exe` is in the `DatabaseCleanWashing` directory.
2. **Edit Database Name**: Open the script and set `$databaseName` to match your database name (without `.db`).
3. **Run the Script**:
 - Open PowerShell in the `DatabaseCleanWashing` directory.
 - Run the script by entering:
   ```powershell
   .\database_clean_washing.ps1
   ```

### Script Output

The script will generate the following files in the `DatabaseCleanWashing` directory:

- **Database Backup**: A timestamped backup of the database in the format `<databaseName>_yyyy.MM.dd_HH.mm.ss.db`.
- **db_assets.txt**: Contains Mod Asset paths found in the database (only created if assets are found).
- **mod_assets.txt**: Contains Mod Asset paths extracted from `.pak` files (only created if `.pak` files are found).
- **wrong_assets.txt**: Lists "wrong assets" from the database that do not match any assets in the `.pak` files. This file is only generated if mismatches are found.

### Additional Notes

- If no Mod Assets are found in `.pak` files, `mod_assets.txt` will not be created.
- If the database query returns no assets, `db_assets.txt` will not be created.
- If there are no mismatches, `wrong_assets.txt` will not be created.
- If `$databaseName` is empty or contains only whitespace, the script will display an error and exit.

## Example Directory Structure

```plaintext
ConanSandbox
└── Saved
  └── DatabaseCleanWashing
      ├── database_clean_washing.ps1
      ├── UnrealPak.exe
      ├── savagewilds_game.db         # Example database file
      ├── savagewilds_game_2024.11.09_14.25.00.db   # Example backup file
      ├── db_assets.txt               # Generated by script if assets are found
      ├── mod_assets.txt              # Generated by script if .pak files are found
      └── wrong_assets.txt            # Generated if mismatched assets are found
